<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
<meta name="theme-color" content="#0f172a">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="description" content="≈ûekerKerim √ñzel G√ºvenlik Sƒ±nav Sistemi">

<title>≈ûekerKerim Platinum | Next-Gen Security</title>

<link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;700;900&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

<style>
    :root {
        --bg-body: #0f172a;
        --card-bg: rgba(30, 41, 59, 0.7);
        --glass-border: rgba(255, 255, 255, 0.08);
        --primary: #06b6d4; /* Cyan */
        --primary-dark: #0891b2;
        --secondary: #8b5cf6; /* Violet */
        --success: #10b981; /* Green */
        --success-glow: rgba(16, 185, 129, 0.4);
        --danger: #ef4444; /* Red */
        --danger-glow: rgba(239, 68, 68, 0.4);
        --text: #f8fafc;
        --text-dim: #94a3b8;
        --notch-padding: env(safe-area-inset-top);
        --bottom-padding: env(safe-area-inset-bottom);
    }

    * { 
        box-sizing: border-box; 
        -webkit-tap-highlight-color: transparent; 
        outline: none; 
        user-select: none; 
        -webkit-user-select: none;
    }
    
    html, body {
        margin: 0; padding: 0;
        font-family: 'Outfit', sans-serif;
        background: var(--bg-body);
        color: var(--text);
        height: 100%;
        width: 100%;
        overflow: hidden;
        overscroll-behavior: none; /* iOS Elastic scroll prevent */
    }

    /* --- ANIMATED BACKGROUND --- */
    .ambient-light {
        position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1;
        background: 
            radial-gradient(circle at 15% 15%, rgba(6, 182, 212, 0.12), transparent 40%),
            radial-gradient(circle at 85% 85%, rgba(139, 92, 246, 0.12), transparent 40%);
        animation: breath 8s ease-in-out infinite alternate;
    }
    @keyframes breath { 0% { opacity: 0.6; transform: scale(1); } 100% { opacity: 1; transform: scale(1.05); } }

    /* --- LAYOUT --- */
    .app-viewport {
        display: flex; flex-direction: column;
        height: 100%;
        padding-top: max(20px, var(--notch-padding));
        padding-bottom: calc(80px + var(--bottom-padding));
        overflow-y: auto;
        scroll-behavior: smooth;
    }

    .container {
        padding: 0 20px;
        max-width: 600px;
        margin: 0 auto;
        width: 100%;
    }

    .hidden { display: none !important; }
    .fade-in { animation: fadeIn 0.4s cubic-bezier(0.2, 0.8, 0.2, 1); }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(15px); } to { opacity: 1; transform: translateY(0); } }

    /* --- HEADER & TICKER --- */
    header {
        display: flex; justify-content: space-between; align-items: center;
        margin-bottom: 20px;
    }
    .brand h1 { 
        margin: 0; font-size: 1.6rem; font-weight: 900; letter-spacing: -1px; 
        background: linear-gradient(to right, #fff, #cbd5e1); 
        -webkit-background-clip: text; -webkit-text-fill-color: transparent; 
    }
    .brand span { font-size: 0.65rem; color: var(--primary); font-weight: 700; letter-spacing: 2.5px; text-transform: uppercase; display: block; margin-top: 2px;}
    
    .rank-pill {
        background: rgba(255,255,255,0.07); padding: 6px 14px; border-radius: 20px;
        font-size: 0.75rem; border: 1px solid var(--glass-border); display: flex; align-items: center; gap: 6px;
        backdrop-filter: blur(5px);
    }

    /* Kayan Yazƒ± Bandƒ± */
    .ticker-wrap {
        width: 100%; overflow: hidden; background: rgba(6, 182, 212, 0.1); 
        border-top: 1px solid rgba(6, 182, 212, 0.2); border-bottom: 1px solid rgba(6, 182, 212, 0.2);
        padding: 8px 0; margin-bottom: 20px; white-space: nowrap; position: relative;
    }
    .ticker { display: inline-block; animation: marquee 20s linear infinite; }
    .ticker-item { display: inline-block; padding: 0 2rem; font-size: 0.85rem; color: var(--primary); font-weight: 600; text-transform: uppercase; letter-spacing: 1px;}
    @keyframes marquee { 0% { transform: translate3d(0, 0, 0); } 100% { transform: translate3d(-50%, 0, 0); } }

    /* --- CARDS --- */
    .card {
        background: var(--card-bg);
        backdrop-filter: blur(24px); -webkit-backdrop-filter: blur(24px);
        border: 1px solid var(--glass-border);
        border-radius: 24px; padding: 24px; margin-bottom: 20px;
        box-shadow: 0 10px 40px -10px rgba(0,0,0,0.4);
    }

    /* --- EXAM UI --- */
    .timer-bar {
        width: 100%; height: 6px; background: rgba(255,255,255,0.1); border-radius: 3px; margin-top: 5px; overflow: hidden;
    }
    .timer-fill {
        height: 100%; background: var(--primary); width: 100%; transition: width 1s linear;
    }

    .q-text { font-size: 1.15rem; font-weight: 600; line-height: 1.6; margin-top: 10px;}
    
    /* Geli≈ümi≈ü ≈ûƒ±k Tasarƒ±mƒ± */
    .option {
        background: rgba(255,255,255,0.03);
        border: 1px solid rgba(255,255,255,0.08);
        padding: 18px; border-radius: 16px; margin-bottom: 12px;
        display: flex; align-items: center; cursor: pointer; 
        transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
        position: relative; overflow: hidden;
        touch-action: manipulation;
    }
    
    .option:active { transform: scale(0.98); }
    
    .opt-char { 
        width: 32px; height: 32px; border-radius: 8px; background: rgba(255,255,255,0.1);
        display: flex; align-items: center; justify-content: center; font-weight: 700; margin-right: 15px; flex-shrink: 0;
        font-size: 0.9rem; transition: 0.3s;
    }

    /* Cevaplama Durumlarƒ± (Correct/Wrong System) */
    .option.correct {
        background: rgba(16, 185, 129, 0.15); border-color: var(--success);
        box-shadow: 0 0 15px var(--success-glow);
    }
    .option.correct .opt-char { background: var(--success); color: #fff; }

    .option.wrong {
        background: rgba(239, 68, 68, 0.15); border-color: var(--danger);
        animation: shake 0.4s ease-in-out;
    }
    .option.wrong .opt-char { background: var(--danger); color: #fff; }

    /* Cevap verildikten sonra diƒüer ≈üƒ±klarƒ±n pasifle≈ümesi */
    .options-locked .option { pointer-events: none; opacity: 0.6; }
    .options-locked .option.correct, .options-locked .option.wrong { opacity: 1; }

    @keyframes shake { 0%, 100% { transform: translateX(0); } 25% { transform: translateX(-5px); } 75% { transform: translateX(5px); } }

    /* --- BOTTOM NAV --- */
    .bottom-nav {
        position: fixed; bottom: 0; left: 0; width: 100%;
        background: rgba(15, 23, 42, 0.85); backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px);
        border-top: 1px solid var(--glass-border);
        display: flex; justify-content: space-around;
        padding-top: 12px; padding-bottom: max(12px, var(--bottom-padding));
        z-index: 100;
    }
    .nav-item {
        display: flex; flex-direction: column; align-items: center; justify-content: center;
        color: var(--text-dim); font-size: 0.7rem; transition: 0.3s; width: 60px;
    }
    .nav-item svg { width: 24px; height: 24px; margin-bottom: 4px; fill: currentColor; transition: 0.3s; }
    .nav-item.active { color: var(--primary); }
    .nav-item.active svg { transform: translateY(-3px); filter: drop-shadow(0 4px 6px var(--primary-glow)); }

    /* --- BUTTONS --- */
    .btn-action {
        width: 100%; padding: 18px; border-radius: 16px; border: none;
        font-size: 1rem; font-weight: 700; color: #fff; cursor: pointer;
        display: flex; align-items: center; justify-content: center; gap: 10px;
        transition: 0.3s;
        box-shadow: 0 4px 6px rgba(0,0,0,0.2);
    }
    .btn-glow { background: linear-gradient(135deg, var(--primary), var(--secondary)); }
    .btn-glow:active { transform: scale(0.97); }
    
    /* --- GRID MODAL --- */
    .modal-overlay {
        position: fixed; top: 0; left: 0; width: 100%; height: 100%;
        background: rgba(0,0,0,0.6); backdrop-filter: blur(8px);
        z-index: 200; visibility: hidden; opacity: 0; transition: 0.3s;
        display: flex; align-items: flex-end;
    }
    .modal-overlay.open { visibility: visible; opacity: 1; }
    .modal-content {
        background: #1e293b; width: 100%; border-radius: 30px 30px 0 0;
        padding: 30px 20px calc(20px + var(--bottom-padding)) 20px;
        max-height: 85vh; overflow-y: auto;
        transform: translateY(100%); transition: transform 0.3s cubic-bezier(0.2, 0.8, 0.2, 1);
        box-shadow: 0 -10px 40px rgba(0,0,0,0.5);
    }
    .modal-overlay.open .modal-content { transform: translateY(0); }
    
    .grid-container { display: grid; grid-template-columns: repeat(5, 1fr); gap: 10px; }
    .grid-item {
        aspect-ratio: 1; background: rgba(255,255,255,0.05); border-radius: 10px;
        display: flex; align-items: center; justify-content: center; font-weight: 700; font-size: 0.9rem;
    }
    .grid-item.correct { background: var(--success); color: #fff; }
    .grid-item.wrong { background: var(--danger); color: #fff; }
    .grid-item.current { border: 2px solid #fff; }
</style>
</head>
<body>

<div class="ambient-light"></div>

<div class="ticker-wrap">
    <div class="ticker">
        <div class="ticker-item">‚≠ê ≈ûEKERKERƒ∞M PLATINUM VIP √úYELER:</div>
        <div class="ticker-item">ABDUL SAMET</div>
        <div class="ticker-item">SUDEM</div>
        <div class="ticker-item">POLƒ∞S ABƒ∞</div>
        <div class="ticker-item">KENAN KOMUTAN</div>
        <div class="ticker-item">VE ƒ∞≈ûTE Dƒ∞ƒûERLERƒ∞...</div>
        <div class="ticker-item">‚≠ê ≈ûEKERKERƒ∞M PLATINUM VIP √úYELER:</div>
        <div class="ticker-item">ABDUL SAMET</div>
        <div class="ticker-item">SUDEM</div>
        <div class="ticker-item">POLƒ∞S ABƒ∞</div>
    </div>
</div>

<div class="app-viewport">
    
    <div id="view-dashboard" class="container fade-in">
        <header>
            <div class="brand">
                <h1>≈ûEKERKERIM</h1>
                <span>NEXT-GEN SECURITY</span>
            </div>
            <div class="rank-pill" id="user-rank">üéñÔ∏è √áaylak</div>
        </header>

        <div class="card">
            <h2 style="margin-top:0;">Hazƒ±r mƒ±sƒ±n? üõ°Ô∏è</h2>
            <p style="color:var(--text-dim); font-size:0.95rem;">Anlƒ±k geri bildirimli, profesyonel sƒ±nav sim√ºlasyonu.</p>
            
            <div style="display:grid; grid-template-columns:1fr 1fr; gap:15px; margin-top:25px;">
                <div onclick="startExam('silahsƒ±z')" style="background:rgba(6,182,212,0.1); padding:20px; border-radius:20px; border:1px solid var(--primary); cursor:pointer; text-align:center; transition:0.2s;" onmousedown="this.style.transform='scale(0.96)'" onmouseup="this.style.transform='scale(1)'">
                    <div style="font-size:2.2rem; margin-bottom:8px;">üõ°Ô∏è</div>
                    <div style="font-weight:700; color:var(--primary);">Sƒ∞LAHSIZ</div>
                    <div style="font-size:0.75rem; opacity:0.7;">100 Soru ‚Ä¢ Eƒüitim Modu</div>
                </div>
                <div onclick="startExam('silahlƒ±')" style="background:rgba(139,92,246,0.1); padding:20px; border-radius:20px; border:1px solid var(--secondary); cursor:pointer; text-align:center; transition:0.2s;" onmousedown="this.style.transform='scale(0.96)'" onmouseup="this.style.transform='scale(1)'">
                    <div style="font-size:2.2rem; margin-bottom:8px;">üî´</div>
                    <div style="font-weight:700; color:var(--secondary);">Sƒ∞LAHLI</div>
                    <div style="font-size:0.75rem; opacity:0.7;">125 Soru ‚Ä¢ Eƒüitim Modu</div>
                </div>
            </div>
        </div>

        <div class="card">
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px;">
                <h3 style="margin:0;">Haftalƒ±k Performans</h3>
                <span style="font-size:0.8rem; color:var(--primary);">Detaylar ‚Üí</span>
            </div>
            <canvas id="miniChart" height="120"></canvas>
        </div>
    </div>

    <div id="view-exam" class="container hidden">
        <div style="display:flex; justify-content:space-between; align-items:flex-end; margin-bottom:10px;">
            <div>
                <span style="font-size:0.75rem; color:var(--text-dim); letter-spacing:1px;">SORU</span>
                <div style="font-size:1.5rem; font-weight:800;" id="q-counter">1<span style="font-size:1rem; color:var(--text-dim); font-weight:500;">/100</span></div>
            </div>
            <div style="text-align:right;">
                <div style="font-family:monospace; font-size:1.2rem; font-weight:700;" id="timer-text">120:00</div>
            </div>
        </div>
        
        <div class="timer-bar"><div class="timer-fill" id="timer-bar"></div></div>

        <div class="card" style="margin-top:20px; min-height:160px; display:flex; flex-direction:column; justify-content:center;">
            <div style="background:rgba(255,255,255,0.1); padding:4px 10px; border-radius:6px; font-size:0.65rem; color:var(--text-dim); align-self:flex-start; margin-bottom:10px; text-transform:uppercase; letter-spacing:1px;" id="q-category">KATEGORƒ∞</div>
            <div class="q-text" id="q-text">Soru y√ºkleniyor...</div>
        </div>

        <div id="options-container">
            </div>

        <div style="display:flex; gap:15px; margin-top:25px; padding-bottom:30px;">
            <button onclick="toggleGrid()" style="flex:1; background:rgba(255,255,255,0.1); padding:15px; border-radius:14px; border:none; color:#fff;">üìã Liste</button>
            <button onclick="nextQuestion()" class="btn-action btn-glow" style="flex:2;">Sonraki Soru ‚û°</button>
        </div>
    </div>

    <div id="view-profile" class="container hidden fade-in">
        <div style="text-align:center; margin:40px 0;">
            <div style="width:110px; height:110px; margin:0 auto 20px; border-radius:50%; background:linear-gradient(45deg, var(--primary), var(--secondary)); display:flex; align-items:center; justify-content:center; font-size:3rem; box-shadow:0 0 30px var(--secondary);">üòé</div>
            <h2 id="profile-name-display">Misafir Kullanƒ±cƒ±</h2>
            <p style="color:var(--text-dim);">Abdul Samet'in Devresi</p>
        </div>

        <div class="card">
            <label style="font-size:0.8rem; color:var(--text-dim); margin-bottom:8px; display:block;">PROFƒ∞L AYARLARI</label>
            <input type="text" id="name-input" placeholder="Adƒ±nƒ± Buraya Yaz" style="width:100%; padding:16px; background:rgba(0,0,0,0.3); border:1px solid rgba(255,255,255,0.1); border-radius:12px; color:#fff; font-size:1rem;" oninput="updateName(this.value)">
            <button class="btn-action" style="background:#333; margin-top:15px;" onclick="resetData()">Verileri Sƒ±fƒ±rla</button>
        </div>
    </div>

</div>

<nav class="bottom-nav">
    <div class="nav-item active" onclick="switchTab('dashboard')" id="nav-dashboard">
        <svg viewBox="0 0 24 24"><path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"/></svg>
        Anasayfa
    </div>
    <div class="nav-item" onclick="switchTab('profile')" id="nav-profile">
        <svg viewBox="0 0 24 24"><path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/></svg>
        Profil
    </div>
</nav>

<div class="modal-overlay" id="grid-modal" onclick="if(event.target === this) toggleGrid()">
    <div class="modal-content">
        <div style="display:flex; justify-content:space-between; margin-bottom:20px; align-items:center;">
            <h3>Soru Haritasƒ±</h3>
            <button onclick="finishExam()" style="background:var(--danger); border:none; color:#fff; padding:8px 16px; border-radius:8px; font-weight:700;">TESTƒ∞ Bƒ∞Tƒ∞R</button>
        </div>
        <div class="grid-container" id="grid-container"></div>
    </div>
</div>

<script>
    // --- VERƒ∞ TABANI (Sorular) ---
    const rawQuestions = [
        {c:"HUKUK", q:"5188 sayƒ±lƒ± Kanuna g√∂re, √∂zel g√ºvenlik g√∂revlisi a≈üaƒüƒ±dakilerden hangisini yapamaz?", o:["Yakalama", "Emanete alma", "ƒ∞fade alma", "Zor kullanma", "Kimlik sorma"], a:2},
        {c:"ƒ∞LK YARDIM", q:"Yeti≈ükin bir insanda dakika solunum sayƒ±sƒ± normalde ne kadardƒ±r?", o:["12-20", "20-25", "8-10", "30-40", "50-60"], a:0},
        {c:"Sƒ∞LAH", q:"Fi≈üek yataƒüƒ±nda fi≈üek olup olmadƒ±ƒüƒ±nƒ± g√∂steren emniyet tertibatƒ± hangisidir?", o:["Kabza emniyeti", "ƒ∞ƒüne emniyeti", "Horoz emniyeti", "ƒ∞kaz pimi (Tƒ±rnak)", "≈ûarj√∂r emniyeti"], a:3},
        {c:"ƒ∞LETƒ∞≈ûƒ∞M", q:"ƒ∞leti≈üimde 'Empati' nedir?", o:["Sempati duymak", "Kendini kar≈üƒ±sƒ±ndakinin yerine koymak", "√ñƒü√ºt vermek", "Ele≈ütirmek", "Dinlememek"], a:1},
        {c:"G√úVENLƒ∞K", q:"Kontrol noktasƒ±ndan ge√ßen ziyaret√ßinin √ºzerinde silah tespit edilirse ne yapƒ±lƒ±r?", o:["El konulur", "Emanete alƒ±nƒ±r", "Polise haber verilir", "Geri g√∂nderilir", "≈ûahƒ±s d√∂v√ºl√ºr"], a:2},
        {c:"YANGIN", q:"B sƒ±nƒ±fƒ± (Sƒ±vƒ±) yangƒ±nlarda en etkili s√∂nd√ºr√ºc√º madde nedir?", o:["Su", "K√∂p√ºk", "Kum", "Bor", "Toprak"], a:1},
        {c:"Sƒ∞LAH", q:"Tabancada iƒüneye darbe yaparak patlamayƒ± ger√ßekle≈ütiren par√ßa hangisidir?", o:["Tetik", "Horoz", "Namlu", "Gez", "Arpacƒ±k"], a:1},
        {c:"HUKUK", q:"√ñzel g√ºvenlik kimlik kartƒ± ka√ß yƒ±lda bir yenilenir?", o:["2", "3", "4", "5", "10"], a:3},
        {c:"KORUMA", q:"√ñnemli ki≈üi koruma (VIP) hizmetlerinde temel ama√ß nedir?", o:["Saldƒ±rganƒ± yakalamak", "VIP'i ka√ßƒ±rmak/uzakla≈ütƒ±rmak", "√áatƒ±≈ümak", "Yolu kapatmak", "Kalabalƒ±ƒüƒ± daƒüƒ±tmak"], a:1},
        {c:"TEKNƒ∞K", q:"X-Ray cihazƒ± temel olarak neyin tespitinde kullanƒ±lƒ±r?", o:["Patlayƒ±cƒ±", "Uyu≈üturucu", "Metal", "Plastik", "Sƒ±vƒ±"], a:2}
    ];

    // --- STATE MANAGEMENT ---
    let app = {
        exam: {
            active: false,
            questions: [],
            answers: [], // { given: index, correct: bool }
            currentIdx: 0,
            timeLeft: 0,
            timer: null
        },
        user: {
            name: localStorage.getItem('sk_name') || 'Misafir',
            stats: JSON.parse(localStorage.getItem('sk_stats')) || [10, 40, 30, 70, 50, 90]
        }
    };

    // --- BA≈ûLATMA ---
    window.onload = () => {
        document.getElementById('profile-name-display').innerText = app.user.name;
        document.getElementById('name-input').value = app.user.name;
        renderChart();
    };

    // --- NAVƒ∞GASYON ---
    function switchTab(tab) {
        // Alt men√º aktifliƒüi
        document.querySelectorAll('.nav-item').forEach(i => i.classList.remove('active'));
        document.getElementById(`nav-${tab}`).classList.add('active');
        
        // Ekran deƒüi≈üimi
        ['dashboard', 'exam', 'profile'].forEach(v => {
            const el = document.getElementById(`view-${v}`);
            if(v === tab) {
                el.classList.remove('hidden');
                if(tab === 'dashboard') renderChart(); // Chart refresh
            } else {
                el.classList.add('hidden');
            }
        });
    }

    // --- SINAV MOTORU ---
    function startExam(type) {
        // Demo i√ßin sorularƒ± √ßoƒüalt
        let pool = [];
        const count = type === 'silahsƒ±z' ? 10 : 15; // Demo i√ßin kƒ±sa tuttum, 100 yaparsan array duplicate et
        while(pool.length < count) pool.push(...rawQuestions);
        pool = pool.slice(0, count).sort(() => Math.random() - 0.5);

        app.exam = {
            active: true,
            questions: pool,
            answers: new Array(count).fill(null),
            currentIdx: 0,
            timeLeft: (type === 'silahsƒ±z' ? 120 : 150) * 60,
            timer: setInterval(tick, 1000)
        };

        document.querySelector('.bottom-nav').classList.add('hidden'); // Sƒ±navda men√ºy√º gizle
        switchTab('exam');
        renderQuestion();
    }

    function tick() {
        if(app.exam.timeLeft <= 0) { finishExam(); return; }
        app.exam.timeLeft--;
        
        // S√ºre Formatƒ±
        const m = Math.floor(app.exam.timeLeft / 60);
        const s = app.exam.timeLeft % 60;
        document.getElementById('timer-text').innerText = `${m}:${s < 10 ? '0'+s : s}`;
        
        // Progress Bar
        const totalTime = 120 * 60;
        const pct = (app.exam.timeLeft / totalTime) * 100;
        document.getElementById('timer-bar').style.width = pct + '%';
        
        if(pct < 20) document.getElementById('timer-bar').style.background = 'var(--danger)';
    }

    function renderQuestion() {
        const q = app.exam.questions[app.exam.currentIdx];
        const status = app.exam.answers[app.exam.currentIdx]; // null or {given:X, correct:bool}

        document.getElementById('q-counter').innerHTML = `${app.exam.currentIdx + 1}<span style="font-size:1rem; color:var(--text-dim); font-weight:500;">/${app.exam.questions.length}</span>`;
        document.getElementById('q-category').innerText = q.c;
        document.getElementById('q-text').innerText = q.q;

        const container = document.getElementById('options-container');
        container.innerHTML = '';
        container.className = status ? 'options-locked' : '';

        q.o.forEach((opt, idx) => {
            const div = document.createElement('div');
            let className = 'option';
            
            // Eƒüer cevap verildiyse renklendir
            if(status) {
                if(idx === q.a) className += ' correct'; // Doƒüru olan her zaman ye≈üil yanar
                if(idx === status.given && !status.correct) className += ' wrong'; // Yanlƒ±≈ü se√ßtiyse kƒ±rmƒ±zƒ±
            }

            div.className = className;
            div.innerHTML = `<div class="opt-char">${String.fromCharCode(65+idx)}</div> ${opt}`;
            
            // Tƒ±klama olaylarƒ±
            if(!status) {
                div.onclick = () => checkAnswer(idx, q.a);
            }
            
            container.appendChild(div);
        });
    }

    // --- DOƒûRU/YANLI≈û Sƒ∞STEMƒ∞ (HEART OF THE SYSTEM) ---
    function checkAnswer(selectedIdx, correctIdx) {
        const isCorrect = selectedIdx === correctIdx;
        
        // State Kaydet
        app.exam.answers[app.exam.currentIdx] = {
            given: selectedIdx,
            correct: isCorrect
        };

        // Haptik Geri Bildirim (Android Titre≈üim)
        if(navigator.vibrate) {
            if(isCorrect) navigator.vibrate(50); // Kƒ±sa titre≈üim
            else navigator.vibrate([100, 50, 100]); // ƒ∞ki kere titret (Hata)
        }

        renderQuestion(); // UI G√ºncelle (Renklendir)
    }

    function nextQuestion() {
        if(app.exam.currentIdx < app.exam.questions.length - 1) {
            app.exam.currentIdx++;
            renderQuestion();
        } else {
            // Son soruda ise listeyi a√ß
            toggleGrid();
        }
    }

    // --- GRID MENU ---
    function toggleGrid() {
        const modal = document.getElementById('grid-modal');
        const container = document.getElementById('grid-container');
        
        if(!modal.classList.contains('open')) {
            // Render Grid
            container.innerHTML = '';
            app.exam.answers.forEach((ans, i) => {
                const div = document.createElement('div');
                let cls = 'grid-item';
                if(i === app.exam.currentIdx) cls += ' current';
                if(ans) cls += ans.correct ? ' correct' : ' wrong';
                
                div.className = cls;
                div.innerText = i + 1;
                div.onclick = () => {
                    app.exam.currentIdx = i;
                    renderQuestion();
                    toggleGrid();
                };
                container.appendChild(div);
            });
            modal.classList.add('open');
        } else {
            modal.classList.remove('open');
        }
    }

    function finishExam() {
        clearInterval(app.exam.timer);
        document.querySelector('.bottom-nav').classList.remove('hidden');
        document.getElementById('grid-modal').classList.remove('open');

        // Puan Hesapla
        const correctCount = app.exam.answers.filter(a => a && a.correct).length;
        const score = (correctCount / app.exam.questions.length) * 100;

        // Dashboard'a d√∂n
        switchTab('dashboard');

        // Konfeti Patlat (Eƒüer ba≈üarƒ±lƒ±ysa)
        if(score >= 60) {
            triggerConfetti();
        }

        // Kullanƒ±cƒ± istatistik g√ºncelle (Demo fake veri itme)
        app.user.stats.push(score);
        app.user.stats.shift();
        localStorage.setItem('sk_stats', JSON.stringify(app.user.stats));
        renderChart();

        alert(`SINAV TAMAMLANDI!\n\nPuanƒ±nƒ±z: ${Math.round(score)}\nDoƒüru Sayƒ±sƒ±: ${correctCount}`);
    }

    // --- GRAFƒ∞K (Chart.js) ---
    function renderChart() {
        const ctx = document.getElementById('miniChart').getContext('2d');
        if(window.myChart) window.myChart.destroy();
        
        window.myChart = new Chart(ctx, {
            type: 'line',
            data: {
                labels: ['1.D', '2.D', '3.D', '4.D', '5.D', 'Son'],
                datasets: [{
                    label: 'Puan',
                    data: app.user.stats,
                    borderColor: '#06b6d4',
                    backgroundColor: 'rgba(6, 182, 212, 0.15)',
                    borderWidth: 3,
                    tension: 0.4,
                    fill: true,
                    pointBackgroundColor: '#fff'
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: { legend: {display: false} },
                scales: {
                    x: { display: false },
                    y: { display: false, min: 0, max: 100 }
                }
            }
        });
    }

    // --- KULLANICI AYARLARI ---
    function updateName(val) {
        app.user.name = val;
        localStorage.setItem('sk_name', val);
        document.getElementById('profile-name-display').innerText = val;
    }

    function resetData() {
        if(confirm('T√ºm ilerlemen silinecek. Emin misin?')) {
            localStorage.clear();
            location.reload();
        }
    }

    function triggerConfetti() {
        var duration = 3 * 1000;
        var end = Date.now() + duration;

        (function frame() {
            confetti({
                particleCount: 5,
                angle: 60,
                spread: 55,
                origin: { x: 0 },
                colors: ['#06b6d4', '#8b5cf6']
            });
            confetti({
                particleCount: 5,
                angle: 120,
                spread: 55,
                origin: { x: 1 },
                colors: ['#06b6d4', '#8b5cf6']
            });

            if (Date.now() < end) {
                requestAnimationFrame(frame);
            }
        }());
    }

</script>
</body>
</html>
