<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
<meta name="theme-color" content="#0f172a">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="description" content="≈ûekerKerim √ñzel G√ºvenlik Sƒ±nav Sistemi">

<title>≈ûekerKerim Platinum | Ultimate</title>

<link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;700;900&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

<style>
    :root {
        --bg-body: #0b1120;
        --card-bg: rgba(30, 41, 59, 0.65);
        --glass-border: rgba(255, 255, 255, 0.08);
        --primary: #06b6d4; /* Cyan */
        --primary-glow: rgba(6, 182, 212, 0.5);
        --secondary: #8b5cf6; /* Violet */
        --success: #10b981;
        --danger: #ef4444;
        --gold: #f59e0b;
        --text: #f8fafc;
        --text-dim: #94a3b8;
        --safe-top: env(safe-area-inset-top);
        --safe-bottom: env(safe-area-inset-bottom);
    }

    * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; outline: none; user-select: none; -webkit-user-select: none; }
    
    body {
        margin: 0; padding: 0;
        font-family: 'Outfit', sans-serif;
        background: var(--bg-body);
        color: var(--text);
        height: 100vh;
        overflow: hidden;
        overscroll-behavior: none;
    }

    /* --- DYNAMIC BACKGROUND --- */
    .bg-mesh {
        position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; z-index: -1;
        background: radial-gradient(circle at 0% 0%, rgba(6,182,212,0.15), transparent 40%),
                    radial-gradient(circle at 100% 100%, rgba(139,92,246,0.15), transparent 40%);
        filter: blur(40px);
    }

    /* --- APP LAYOUT --- */
    .app-container {
        display: flex; flex-direction: column;
        height: 100%;
        padding-top: max(10px, var(--safe-top));
        padding-bottom: calc(70px + var(--safe-bottom));
        position: relative;
    }

    .scroll-view {
        flex: 1; overflow-y: auto; padding: 0 20px;
        scroll-behavior: smooth;
    }

    .hidden { display: none !important; }
    .fade-in { animation: fadeIn 0.4s ease-out; }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

    /* --- TICKER (KAYAN YAZI) --- */
    .ticker-container {
        background: linear-gradient(90deg, rgba(6,182,212,0.1), rgba(139,92,246,0.1));
        border-bottom: 1px solid var(--glass-border);
        height: 36px; display: flex; align-items: center; overflow: hidden;
        margin-bottom: 15px; position: relative;
    }
    .ticker-content {
        display: flex; white-space: nowrap;
        animation: tickerScroll 45s linear infinite; /* ƒ∞simler √ßok olduƒüu i√ßin s√ºre uzatƒ±ldƒ± */
    }
    .ticker-item {
        padding: 0 20px; font-size: 0.75rem; font-weight: 700; 
        color: var(--primary); text-transform: uppercase; letter-spacing: 0.5px;
        display: flex; align-items: center; gap: 5px;
    }
    @keyframes tickerScroll { 0% { transform: translateX(0); } 100% { transform: translateX(-100%); } }

    /* --- CARDS & UI --- */
    .card {
        background: var(--card-bg);
        backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px);
        border: 1px solid var(--glass-border);
        border-radius: 24px; padding: 20px; margin-bottom: 15px;
        box-shadow: 0 8px 32px rgba(0,0,0,0.3);
    }

    .header-row { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
    .brand-title { font-size: 1.5rem; font-weight: 900; background: linear-gradient(to right, #fff, #94a3b8); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
    
    .streak-badge {
        background: rgba(245, 158, 11, 0.2); color: var(--gold); border: 1px solid rgba(245, 158, 11, 0.4);
        padding: 5px 12px; border-radius: 20px; font-size: 0.8rem; font-weight: bold;
        display: flex; align-items: center; gap: 5px; opacity: 0; transition: 0.3s;
    }
    .streak-badge.active { opacity: 1; transform: scale(1.1); }

    /* --- EXAM QUESTION CARD --- */
    .question-card {
        min-height: 180px; display: flex; flex-direction: column; justify-content: center;
        position: relative; overflow: hidden;
    }
    /* Swipe Indicators */
    .swipe-hint {
        position: absolute; top: 50%; transform: translateY(-50%);
        font-size: 2rem; color: rgba(255,255,255,0.1); pointer-events: none;
    }
    .swipe-left { left: 10px; } .swipe-right { right: 10px; }

    .q-badge { background: rgba(255,255,255,0.1); padding: 4px 10px; border-radius: 6px; font-size: 0.7rem; color: var(--text-dim); text-transform: uppercase; align-self: flex-start; margin-bottom: 10px; }
    .q-text { font-size: 1.25rem; font-weight: 600; line-height: 1.5; }

    /* --- OPTIONS --- */
    .option {
        background: rgba(255,255,255,0.03); border: 1px solid rgba(255,255,255,0.08);
        padding: 16px; border-radius: 16px; margin-bottom: 10px;
        display: flex; align-items: center; transition: 0.2s; position: relative; overflow: hidden;
        cursor: pointer;
    }
    .option:active { transform: scale(0.98); background: rgba(255,255,255,0.06); }
    .opt-char { width: 32px; height: 32px; border-radius: 8px; background: rgba(255,255,255,0.1); display: flex; align-items: center; justify-content: center; font-weight: 700; margin-right: 15px; flex-shrink: 0; }
    
    /* Correct/Wrong Styles */
    .option.correct { background: rgba(16, 185, 129, 0.2); border-color: var(--success); box-shadow: 0 0 15px rgba(16,185,129,0.3); }
    .option.correct .opt-char { background: var(--success); color: #fff; }
    
    .option.wrong { background: rgba(239, 68, 68, 0.2); border-color: var(--danger); animation: shake 0.4s; }
    .option.wrong .opt-char { background: var(--danger); color: #fff; }
    
    @keyframes shake { 0%, 100% { transform: translateX(0); } 25% { transform: translateX(-6px); } 75% { transform: translateX(6px); } }

    /* --- BOTTOM NAV --- */
    .bottom-nav {
        position: fixed; bottom: 0; left: 0; width: 100%;
        background: rgba(15, 23, 42, 0.9); backdrop-filter: blur(20px);
        border-top: 1px solid var(--glass-border);
        display: flex; justify-content: space-around;
        padding-top: 12px; padding-bottom: max(12px, var(--safe-bottom));
        z-index: 50;
    }
    .nav-item { display: flex; flex-direction: column; align-items: center; color: var(--text-dim); font-size: 0.7rem; transition: 0.3s; width: 60px;}
    .nav-item svg { width: 24px; height: 24px; margin-bottom: 4px; fill: currentColor; }
    .nav-item.active { color: var(--primary); transform: translateY(-2px); }
    .nav-item.active svg { filter: drop-shadow(0 0 8px var(--primary)); }

    /* --- BUTTONS --- */
    .btn-grad {
        background: linear-gradient(135deg, var(--primary), var(--secondary));
        color: #fff; border: none; padding: 16px; width: 100%;
        border-radius: 16px; font-weight: 700; font-size: 1rem;
        box-shadow: 0 10px 20px -5px var(--primary-glow);
        cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 8px;
    }
    .btn-grad:active { transform: scale(0.97); }

    /* --- MODAL --- */
    .modal {
        position: fixed; top: 0; left: 0; width: 100%; height: 100%;
        background: rgba(0,0,0,0.7); backdrop-filter: blur(5px);
        z-index: 100; visibility: hidden; opacity: 0; transition: 0.3s;
        display: flex; align-items: flex-end;
    }
    .modal.open { visibility: visible; opacity: 1; }
    .modal-sheet {
        background: #1e293b; width: 100%; border-radius: 24px 24px 0 0;
        padding: 25px 20px calc(20px + var(--safe-bottom)) 20px;
        transform: translateY(100%); transition: 0.3s cubic-bezier(0.2, 0.8, 0.2, 1);
        max-height: 80vh; overflow-y: auto;
    }
    .modal.open .modal-sheet { transform: translateY(0); }

    .grid-box { display: grid; grid-template-columns: repeat(5, 1fr); gap: 8px; }
    .grid-cell { 
        aspect-ratio: 1; background: rgba(255,255,255,0.05); border-radius: 8px; 
        display: flex; align-items: center; justify-content: center; font-weight: 700; font-size: 0.8rem;
    }
    .grid-cell.c { background: var(--success); color: #fff; }
    .grid-cell.w { background: var(--danger); color: #fff; }
    .grid-cell.active { border: 2px solid #fff; }

</style>
</head>
<body>

<div class="bg-mesh"></div>

<div class="ticker-container">
    <div class="ticker-content" id="ticker-track">
        </div>
    <div class="ticker-content" id="ticker-track-2"></div> 
</div>

<div class="app-container">
    
    <div id="view-dashboard" class="scroll-view fade-in">
        <div class="header-row">
            <div>
                <div class="brand-title">≈ûEKERKERIM</div>
                <div style="font-size:0.7rem; color:var(--primary); letter-spacing:2px; font-weight:700;">PLATINUM SECURITY</div>
            </div>
            <div style="text-align:right;">
                 <div id="user-pill" style="background:rgba(255,255,255,0.1); padding:5px 10px; border-radius:15px; font-size:0.7rem;">‚≠ê Misafir</div>
            </div>
        </div>

        <div class="card">
            <h2 style="margin:0 0 10px 0;">Ho≈ügeldin Asker üëã</h2>
            <p style="color:var(--text-dim); font-size:0.9rem; margin-bottom:20px;">Sƒ±nava hazƒ±rlƒ±kta en profesyonel y√∂ntem.</p>
            
            <div style="display:grid; grid-template-columns:1fr 1fr; gap:12px;">
                <button onclick="startExam('silahsƒ±z')" style="background:rgba(6,182,212,0.15); border:1px solid var(--primary); padding:20px; border-radius:16px; color:#fff; text-align:center;">
                    <div style="font-size:2rem; margin-bottom:5px;">üõ°Ô∏è</div>
                    <div style="font-weight:700;">Silahsƒ±z</div>
                    <div style="font-size:0.7rem; opacity:0.7;">100 Soru</div>
                </button>
                <button onclick="startExam('silahlƒ±')" style="background:rgba(139,92,246,0.15); border:1px solid var(--secondary); padding:20px; border-radius:16px; color:#fff; text-align:center;">
                    <div style="font-size:2rem; margin-bottom:5px;">üî´</div>
                    <div style="font-weight:700;">Silahlƒ±</div>
                    <div style="font-size:0.7rem; opacity:0.7;">125 Soru</div>
                </button>
            </div>
        </div>

        <div class="card">
            <div style="display:flex; justify-content:space-between; margin-bottom:10px;">
                <h3>ƒ∞statistikler</h3>
                <span style="color:var(--primary); font-size:0.8rem;">Son 5 Sƒ±nav</span>
            </div>
            <div style="height:120px;"><canvas id="miniChart"></canvas></div>
        </div>
    </div>

    <div id="view-exam" class="scroll-view hidden">
        <div class="header-row">
            <div style="display:flex; flex-direction:column;">
                <span style="font-size:0.7rem; color:var(--text-dim);">ƒ∞LERLEME</span>
                <span style="font-size:1.2rem; font-weight:800;" id="q-progress">1 / 100</span>
            </div>
            <div class="streak-badge" id="streak-box">üî• 3 Seri!</div>
            <div style="font-family:monospace; font-size:1.2rem; font-weight:700;" id="timer">120:00</div>
        </div>

        <div class="card question-card" id="q-card">
            <div class="swipe-hint swipe-left">‚Äπ</div>
            <div class="swipe-hint swipe-right">‚Ä∫</div>
            
            <div class="q-badge" id="q-cat">HUKUK</div>
            <div class="q-text" id="q-text">Y√ºkleniyor...</div>
        </div>

        <div id="options-list"></div>

        <div style="display:flex; gap:10px; margin-top:20px;">
            <button onclick="toggleGrid()" style="flex:1; background:rgba(255,255,255,0.1); border:none; color:#fff; padding:15px; border-radius:12px;">üó∫Ô∏è Harita</button>
            <button onclick="nextQuestion()" class="btn-grad" style="flex:2;">Sonraki ‚û°</button>
        </div>
    </div>

    <div id="view-profile" class="scroll-view hidden fade-in">
        <div style="text-align:center; padding:30px 0;">
             <div style="width:100px; height:100px; background:linear-gradient(45deg, #06b6d4, #8b5cf6); border-radius:50%; margin:0 auto 15px; display:flex; align-items:center; justify-content:center; font-size:2.5rem; box-shadow:0 0 30px var(--primary-glow);">üòé</div>
             <h2 id="profile-name">ƒ∞simsiz</h2>
             <p style="color:var(--text-dim);">Kƒ±demli G√ºvenlik Adayƒ±</p>
        </div>

        <div class="card">
            <label style="font-size:0.8rem; color:var(--text-dim);">ADINI G√úNCELLE</label>
            <input type="text" id="name-input" placeholder="Ad Soyad..." style="width:100%; padding:15px; background:rgba(0,0,0,0.3); border:1px solid var(--glass-border); color:#fff; border-radius:10px; margin-top:5px;" oninput="updateName(this.value)">
        </div>

        <div class="card">
            <h3>VIP √úye Listesi</h3>
            <p style="font-size:0.8rem; color:var(--text-dim);">Bu uygulama a≈üaƒüƒ±daki kahramanlara ithaf edilmi≈ütir:</p>
            <div style="font-size:0.8rem; line-height:1.6; color:#ccc; margin-top:10px;" id="static-vip-list"></div>
        </div>
    </div>

</div>

<nav class="bottom-nav">
    <div class="nav-item active" onclick="switchTab('dashboard')" id="nav-dashboard">
        <svg viewBox="0 0 24 24"><path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"/></svg>
        Anasayfa
    </div>
    <div class="nav-item" onclick="switchTab('exam')" id="nav-exam">
        <svg viewBox="0 0 24 24"><path d="M14 2H6c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 1.99 2H18c1.1 0 2-.9 2-2V8l-6-6zm2 16H8v-2h8v2zm0-4H8v-2h8v2zm-3-5V3.5L18.5 9H13z"/></svg>
        Sƒ±nav
    </div>
    <div class="nav-item" onclick="switchTab('profile')" id="nav-profile">
        <svg viewBox="0 0 24 24"><path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/></svg>
        Profil
    </div>
</nav>

<div class="modal" id="grid-modal" onclick="if(event.target===this) toggleGrid()">
    <div class="modal-sheet">
        <div style="display:flex; justify-content:space-between; margin-bottom:20px;">
            <h3>Soru Haritasƒ±</h3>
            <button onclick="finishExam()" style="background:var(--danger); color:#fff; border:none; padding:5px 15px; border-radius:8px;">Bƒ∞Tƒ∞R</button>
        </div>
        <div class="grid-box" id="grid-content"></div>
    </div>
</div>

<script>
    // --- VIP LISTESI (Kayan Yazƒ±) ---
    const vipNames = [
        "ABDUL SAMET", "FURKAN U√áAR", "TUƒûBA SUDEM", "ƒ∞ZNƒ∞KLƒ∞ G√úVENLƒ∞K", 
        "MELƒ∞H SAK", "MELƒ∞H √ñZAY", "MUHAMMED KONUS", "RAZƒ∞YE KAVRAMAK", 
        "BA≈ûKOM NURULLAH", "YAKI≈ûIKLI G√úVENLƒ∞K OKAN", "AHMET CAN √áEVƒ∞K", 
        "BARAN", "BERƒ∞L KAYA", "CELAL SAHAN", "EMƒ∞N", "EMRE", "ETO", 
        "HATƒ∞CE", "ƒ∞SMAƒ∞L", "RABƒ∞A", "SERHAT OLGUN", "Sƒ∞NAN", "YAƒûMUR", "VE Dƒ∞ƒûERLERƒ∞..."
    ];

    // --- SES MOTORU (Web Audio API - Dosyasƒ±z) ---
    const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    function playSound(type) {
        if(audioCtx.state === 'suspended') audioCtx.resume();
        const osc = audioCtx.createOscillator();
        const gain = audioCtx.createGain();
        osc.connect(gain);
        gain.connect(audioCtx.destination);
        
        if (type === 'correct') {
            osc.type = 'sine';
            osc.frequency.setValueAtTime(600, audioCtx.currentTime);
            osc.frequency.exponentialRampToValueAtTime(1200, audioCtx.currentTime + 0.1);
            gain.gain.setValueAtTime(0.1, audioCtx.currentTime);
            gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.3);
            osc.start(); osc.stop(audioCtx.currentTime + 0.3);
        } else if (type === 'wrong') {
            osc.type = 'sawtooth';
            osc.frequency.setValueAtTime(150, audioCtx.currentTime);
            osc.frequency.linearRampToValueAtTime(100, audioCtx.currentTime + 0.2);
            gain.gain.setValueAtTime(0.1, audioCtx.currentTime);
            gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.3);
            osc.start(); osc.stop(audioCtx.currentTime + 0.3);
        }
    }

    // --- VERƒ∞ ---
    const rawQuestions = [
        {c:"HUKUK", q:"5188 sayƒ±lƒ± Kanuna g√∂re √∂zel g√ºvenlik g√∂revlisi a≈üaƒüƒ±dakilerden hangisini yapamaz?", o:["Yakalama","Emanete alma","Kimlik sorma","ƒ∞fade alma","Zor kullanma"], a:3},
        {c:"ƒ∞LK YARDIM", q:"Bebeklerde bilin√ß kontrol√º nasƒ±l yapƒ±lƒ±r?", o:["Yanaklarƒ±na vurarak","Topuklarƒ±na vurarak","Sarsarak","Su d√∂kerek","Seslenerek"], a:1},
        {c:"Sƒ∞LAH", q:"Fi≈üek yataƒüƒ±nda fi≈üek olduƒüunu g√∂steren emniyet sistemi hangisidir?", o:["≈ûarj√∂r emniyeti","Kabza emniyeti","ƒ∞kaz pimi","Horoz emniyeti","Mandal emniyeti"], a:2},
        {c:"ƒ∞LETƒ∞≈ûƒ∞M", q:"Empati nedir?", o:["Sempati duymak","Kar≈üƒ±dakinin yerine kendini koymak","Akƒ±l vermek","Dinlememek","Emir vermek"], a:1},
        {c:"G√úVENLƒ∞K", q:"X-Ray cihazƒ± temel olarak ne tespit eder?", o:["Patlayƒ±cƒ±","Uyu≈üturucu","Yoƒüunluk farkƒ± (Metal vb.)","Plastik","Sƒ±vƒ±"], a:2},
        {c:"YANGIN", q:"Elektrik yangƒ±nlarƒ±nda hangisi KULLANILMAZ?", o:["Kuru toz","CO2","Su","Halokarbon","K√∂p√ºk"], a:2},
        {c:"KORUMA", q:"VIP korumada temel ama√ß nedir?", o:["Saldƒ±rganƒ± √∂ld√ºrmek","Ki≈üiyi ka√ßƒ±rmak/uzakla≈ütƒ±rmak","Kalabalƒ±ƒüƒ± d√∂vmek","Yolu kapatmak","Medya ile konu≈ümak"], a:1},
        {c:"HUKUK", q:"√ñzel g√ºvenlik kimlik kartƒ± ka√ß yƒ±lda bir yenilenir?", o:["2","3","4","5","S√ºresizdir"], a:3},
        {c:"Sƒ∞LAH", q:"Tetiƒüi √ßekince horozun d√º≈ümesini saƒülayan par√ßa?", o:["ƒ∞ƒüne","Gez","Arpacƒ±k","Tetik manivelasƒ±","Namlu"], a:3},
        {c:"ƒ∞LK YARDIM", q:"Turnike uygulamasƒ± hangi durumda yapƒ±lƒ±r?", o:["Burun kanamasƒ±nda","Uzuv kopmasƒ±nda","Ba≈ü aƒürƒ±sƒ±nda","Kƒ±rƒ±klarda","Yanƒ±klarda"], a:1}
    ];

    // --- STATE ---
    let app = {
        questions: [],
        answers: [], // {given: index, correct: bool}
        idx: 0,
        timer: null,
        timeLeft: 0,
        streak: 0,
        user: localStorage.getItem('sk_user') || '√ñƒürenci'
    };

    // --- INIT ---
    window.onload = () => {
        // Ticker Doldur
        const track = document.getElementById('ticker-track');
        let html = '';
        vipNames.forEach(n => html += `<div class="ticker-item">‚≠ê ${n}</div>`);
        track.innerHTML = html;
        document.getElementById('ticker-track-2').innerHTML = html; // Loop i√ßin

        // Profil
        document.getElementById('name-input').value = app.user;
        document.getElementById('profile-name').innerText = app.user;
        document.getElementById('user-pill').innerText = 'üë§ ' + app.user;

        // Static List
        document.getElementById('static-vip-list').innerHTML = vipNames.join(' ‚Ä¢ ');

        initChart();
        setupSwipe();
    };

    // --- NAVIGATION ---
    function switchTab(tab) {
        document.querySelectorAll('.nav-item').forEach(e => e.classList.remove('active'));
        document.getElementById(`nav-${tab}`).classList.add('active');
        ['dashboard', 'exam', 'profile'].forEach(t => {
            const el = document.getElementById(`view-${t}`);
            if(t === tab) el.classList.remove('hidden');
            else el.classList.add('hidden');
        });
    }

    // --- EXAM LOGIC ---
    function startExam(type) {
        // Prepare Questions
        let pool = [];
        const count = type === 'silahsƒ±z' ? 100 : 125;
        // Demo i√ßin sorularƒ± √ßoƒüaltƒ±yorum
        while(pool.length < count) pool.push(...rawQuestions);
        pool = pool.slice(0, count).sort(() => Math.random() - 0.5);

        app.questions = pool;
        app.answers = new Array(count).fill(null);
        app.idx = 0;
        app.streak = 0;
        app.timeLeft = (type === 'silahsƒ±z' ? 120 : 150) * 60;
        
        document.querySelector('.bottom-nav').classList.add('hidden');
        switchTab('exam');
        renderQuestion();
        
        if(app.timer) clearInterval(app.timer);
        app.timer = setInterval(tick, 1000);
    }

    function tick() {
        app.timeLeft--;
        const m = Math.floor(app.timeLeft / 60);
        const s = app.timeLeft % 60;
        document.getElementById('timer').innerText = `${m}:${s<10?'0'+s:s}`;
        if(app.timeLeft <= 0) finishExam();
    }

    function renderQuestion() {
        const q = app.questions[app.idx];
        const ans = app.answers[app.idx];

        document.getElementById('q-progress').innerText = `${app.idx + 1} / ${app.questions.length}`;
        document.getElementById('q-cat').innerText = q.c;
        document.getElementById('q-text').innerText = q.q;

        const list = document.getElementById('options-list');
        list.innerHTML = '';

        q.o.forEach((opt, i) => {
            const div = document.createElement('div');
            let cls = 'option';
            if(ans) {
                if(i === q.a) cls += ' correct';
                else if(i === ans.given) cls += ' wrong';
                div.style.pointerEvents = 'none'; // Lock
            }
            div.className = cls;
            div.innerHTML = `<div class="opt-char">${String.fromCharCode(65+i)}</div> ${opt}`;
            if(!ans) div.onclick = () => selectAnswer(i, q.a);
            list.appendChild(div);
        });

        // Swipe Hints
        document.querySelector('.swipe-left').style.opacity = app.idx > 0 ? 0.3 : 0;
        document.querySelector('.swipe-right').style.opacity = app.idx < app.questions.length-1 ? 0.3 : 0;
    }

    function selectAnswer(given, correct) {
        const isCorrect = given === correct;
        app.answers[app.idx] = { given, correct: isCorrect };
        
        if(isCorrect) {
            app.streak++;
            playSound('correct');
            if(app.streak > 2) showStreak();
        } else {
            app.streak = 0;
            playSound('wrong');
            if(navigator.vibrate) navigator.vibrate([50, 50, 50]);
            hideStreak();
        }
        
        renderQuestion();
    }

    function showStreak() {
        const badge = document.getElementById('streak-box');
        badge.innerText = `üî• ${app.streak} Seri!`;
        badge.classList.add('active');
    }
    function hideStreak() {
        document.getElementById('streak-box').classList.remove('active');
    }

    function nextQuestion() {
        if(app.idx < app.questions.length - 1) {
            app.idx++;
            renderQuestion();
        } else {
            toggleGrid();
        }
    }
    
    function prevQuestion() {
        if(app.idx > 0) {
            app.idx--;
            renderQuestion();
        }
    }

    // --- SWIPE LOGIC (Dokunmatik Kaydƒ±rma) ---
    function setupSwipe() {
        let touchStartX = 0;
        let touchEndX = 0;
        const card = document.getElementById('q-card');

        card.addEventListener('touchstart', e => {
            touchStartX = e.changedTouches[0].screenX;
        });

        card.addEventListener('touchend', e => {
            touchEndX = e.changedTouches[0].screenX;
            handleGesture();
        });

        function handleGesture() {
            if (touchEndX < touchStartX - 50) nextQuestion(); // Sola kaydƒ±r (ƒ∞leri)
            if (touchEndX > touchStartX + 50) prevQuestion(); // Saƒüa kaydƒ±r (Geri)
        }
    }

    // --- GRID & FINISH ---
    function toggleGrid() {
        const modal = document.getElementById('grid-modal');
        const content = document.getElementById('grid-content');
        
        if(modal.classList.contains('open')) {
            modal.classList.remove('open');
        } else {
            content.innerHTML = '';
            app.answers.forEach((ans, i) => {
                const div = document.createElement('div');
                let cls = 'grid-cell';
                if(i === app.idx) cls += ' active';
                if(ans) cls += ans.correct ? ' c' : ' w';
                div.className = cls;
                div.innerText = i + 1;
                div.onclick = () => {
                    app.idx = i;
                    renderQuestion();
                    toggleGrid();
                };
                content.appendChild(div);
            });
            modal.classList.add('open');
        }
    }

    function finishExam() {
        clearInterval(app.timer);
        document.getElementById('grid-modal').classList.remove('open');
        document.querySelector('.bottom-nav').classList.remove('hidden');
        
        const correct = app.answers.filter(a => a && a.correct).length;
        const score = (correct / app.questions.length) * 100;
        
        switchTab('dashboard');
        
        if(score > 50) {
            confetti({ particleCount: 150, spread: 70, origin: { y: 0.6 } });
        }
        
        alert(`SINAV SONUCU\n\nPuan: ${score.toFixed(0)}\nDoƒüru: ${correct}\nYanlƒ±≈ü: ${app.answers.filter(a => a && !a.correct).length}`);
        
        // Save stats (Mock)
        updateChart(score);
    }

    // --- EXTRAS ---
    function updateName(val) {
        app.user = val;
        localStorage.setItem('sk_user', val);
        document.getElementById('profile-name').innerText = val;
        document.getElementById('user-pill').innerText = 'üë§ ' + val;
    }

    let myChart;
    function initChart() {
        const ctx = document.getElementById('miniChart').getContext('2d');
        myChart = new Chart(ctx, {
            type: 'line',
            data: {
                labels: ['1', '2', '3', '4', '5'],
                datasets: [{
                    label: 'Puan',
                    data: [50, 65, 55, 80, 70],
                    borderColor: '#06b6d4',
                    backgroundColor: 'rgba(6,182,212,0.1)',
                    fill: true,
                    tension: 0.4
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: { legend: { display: false } },
                scales: { x: { display: false }, y: { display: false } }
            }
        });
    }
    
    function updateChart(newScore) {
        const data = myChart.data.datasets[0].data;
        data.shift();
        data.push(newScore);
        myChart.update();
    }
</script>
</body>
</html>
